---
title: 计算机原理之线程与进程
date: 2020-04-10 17:03:50
categories:
 - base
---

## 线程与进程的原理

### 并行
多cpu下的进程是可以并行执行的

### 并发
操作系统的调度器会切换不同的进程到cpu去执行,由于切换速度快,在使用者的感知上似乎多个程序在并发执行,而实际上cpu在同一时刻只能运行单一进程

### 什么是线程
* CPU调度和分配的最小单位
* 一个进程中可以有多个线程,且至少有一个线程
* 同一个进程下的多个线程,共享进程下的全部资源 
* 进程下的内存资源同一时间段内,仅有一定数量的线程可以访问,其他线程需等待当前线程使用完后,才可以使用
* 些内存资源仅能供一个线程使用,为了防止其他线程使用某一内存资源,线程在使用内存时,进行上锁操作,其他线程在遇到资源上锁时,会等待资源解锁才会去使用,这种方式叫互斥锁**mutex**,用于防止多个线程同时读写某一内存区域
* 有些内存资源仅能供一定数量的线程使用,为了解决这样的问题,则会维护一个信号量(**Semaphore**)数值,在一个线程使用时信号量减少,使用后信号量增加,信号值为0时,则不允许其他线程使用
* mutex其实是Semaphore的一个特殊情况,Semaphore完全可以代替mutex,但是因为mutex简单高效,所以在需要资源独占时,我们还是采用mutex
* **线程的切换消耗的资源是比较少的**
* 每个线程都有自己独立的执行栈,线程内存堆和程序计数器
* 不同进程下的线程因为执行上下文,资源等不共享,需要通过消息通信来实现同步

### 什么是进程
* 系统资源分配的最小单位,也是拥有资源的基本单位
* 进程中含有线程,内存,文件/网络句柄等
* 进程切换消耗的资源较大
* **进程的执行需要 读取上下文 程序执行 保存执行上下文**

### 单cpu与多cpu的区别

* 单cpu在同一时间只能执行一个进程,但是多个cpu则可以并行执行多个进程
* 单cpu在单核心的情况下同一时间只能执行单个线程
* 单cpu在多核心的情况下同一时间能执行多个线程